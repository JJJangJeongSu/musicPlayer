let songs = [
    {
        name: 'Bohemian Rhapsody',
        src: 'assets/songs/song1.mp3',
        cover: 'assets/images/song1.jpg',
        artist: 'Queen',
        lyrics: "6 | Mamaaa 9\n | Just killed a man\n 13 | Put a gun against his head, pulled my trigger\n17 | Now he's dead\n19.5 | Mamaaa, life had just begun,\n26.4 | But now I've gone and thrown it all away\n33 | Mama, oooh,\n39.5 | Didn't mean to make you cry,\n43 | If I'm not back again this time tomorrow,\n47.8 | Carry on, carry on as if nothing really matters \n64 | Too late, my time has come,\n71 | Sends shivers down my spine \n74 |  body's aching all The time \n78 |  Goodbye, everybody\n81 |  I've got to go \n84.7 |  Gotta leave you all behind and face the truth\n91.7 |  Mama, oooh\n98 | I don't want to die\n101 | I sometimes wish I'd never been born at all",
    },
    {
        name: 'The Phantom Of The Opera',
        src: 'assets/songs/song2.mp3',
        cover: 'assets/images/song2.jpg',
        artist: 'Nightwish',
        lyrics: '',
    },
    {
        name: 'To the Helfire',
        src: 'assets/songs/song3.mp3',
        cover: 'assets/images/song3.jpg',
        artist: 'Lorna Shore',
        lyrics: '',
    },
    {
        name: 'Hangar 18',
        src: 'assets/songs/song4.mp3',
        cover: 'assets/images/song4.jpg',
        artist: 'Megadeth',
        lyrics: '',
    },
    {
        name: 'High(deat.Aleesia)',
        src: 'assets/songs/song10.mp3',
        cover: 'assets/images/song10.jpg',
        artist: 'JPB',
        lyrics: '',
    },
    {
        name: 'Long Night pt.||',
        src: 'assets/songs/song11.mp3',
        cover: 'assets/images/song11.jpg',
        artist: 'JPB',
        lyrics:
            '2.8 | We gon turn the crib into a club like\n' +
            "5.7 | Hennessy and Buddah screamin' thug life'\n" +
            " 8 | Get it baby, you know I'm the plug, right'\n" +
            " 10 | Buggin' got a feelin' that it's gonna be a long night'\n" +
            " 11 | Whoa'\n" +
            " 13 | Everything I touch turned gold'\n" +
            " 15 | Need no introduction, 'cause they know briggin more''\n" +
            " 17.3 | I hit the lotto, my motto roll up Gelato and Throttle'\n" +
            " 20 | A couple models to caudal who fuckin' brought out the bottles'\n" +
            " 22 | I'm goin' ham'\n" +
            " 23 | This ain't even luck, all planned'\n" +
            " 25 | Y'all know who the fucks I am'\n" +
            " 27 | Burnin' bucks mo bands'\n" +
            " 29 | Always been the M.O. since the start of this'\n" +
            " 30.5 | And now I'm on a mission like I'm Optimus, aye'\n" +
            "  33.5| We gon turn the crib into a club like'\n" +
            "  36 | Hennessy and Buddah screamin' thug life'\n" +
            "  39 | Get it baby, you know I'm the plug, right'\n" +
            "  40 | Buggin' got a feelin' that it's gonna be a long night'\n" +
            "  51 | Got a feelin' that it's gonna be a long night'\n" +
            "  62 | Yеah, never an averagе night'\n" +
            "  64 | Two, four hours up in a day I gotta make it right'\n" +
            "  67 | 18 of those I'm in a cave I gotta make some light'\n" +
            "  69 | Make it hype, even if we breakin' night'\n" +
            "72 | And even if things go left we gotta make 'em right'\n" +
            "74 |  Chillin' with M.I.M.E we triple up aye 'onna double UP'\n" +
            "76.4 | Triple dub, came from the basement we only goin' up'\n" +
            "79 | They lovin' us, up in the booth I'm getting dizzy,'\n" +
            "80  | but aye, the cup is up'\n" +
            "82  | Toast to my people, that's on the come up, aye'\n" +
            "84  | You lit with us, in order by the trigger buzz'\n" +
            "86  | Lookin' at my watches a spirit bomb both hands are goin' up'\n" +
            "88.5  | You comin' coast to coast with us'\n" +
            "90  | See the flows are flowin' over, flowin' yeah'\n" +
            "92  | The cup it run it over title wave up in the ocean,ah'\n" +
            "95  | We gon turn the crib into a club like'\n" +
            "97  | Hennessy and Buddah screamin' thug life'\n" +
            "100  | Get it baby, you know I'm the plug, right'\n" +
            "102  | Buggin' got a feelin' that it's gonna be a long night'\n" +
            "112  | Got a feelin' that it's gonna be a long night'\n",
    },
    {
        name: 'Royalty(ft.Neoni)',
        src: 'assets/songs/song9.mp3',
        cover: 'assets/images/song9.jpg',
        artist: 'Egzod & Maestro Chives ',
        lyrics:
            "11.5 | I've been cold hearted\n" +
            "14 | But I'm just getting started\n" +
            '18 | Got my eyes on the the targetNow\n' +
            '22 | now\n' +
            "32 | 'Til the battles are won\n" +
            "35 | 'Til kingdom come\n" +
            "45 | I'll never run \n" +
            '48 | Best to give me your loyalty\n' +
            "52 | 'Cause I'm taking the world, you'll see\n" +
            "55 | They'll be calling me, calling me\n" +
            "58 | They'll be calling me royalty\n" +
            '60 | Best to give me your loyalty\n' +
            "64 | 'Cause I'm taking the world, you'll see\n" +
            "67 | They'll be calling me, calling me\n" +
            "70 | They'll be calling me royalty\n" +
            "82 | They'll be calling me royalty\n",
    },
    {
        name: 'Moonlight Sonata',
        src: 'assets/songs/song8.mp3',
        cover: 'assets/images/song8.jpg',
        artist: 'Dr.Viossy',
        lyrics: '',
    },
    {
        name: '512',
        src: 'assets/songs/song5.mp3',
        cover: 'assets/images/song5.jpg',
        artist: 'Lamb of God',
        lyrics: '',
    },
    {
        name: 'Tommy T',
        src: 'assets/songs/song6.mp3',
        cover: 'assets/images/song6.jpg',
        artist: 'Wiked x Tommy T',
        lyrics: '',
    },
    {
        name: "You're Nobody",
        src: 'assets/songs/song7.mp3',
        cover: 'assets/images/song7.jpg',
        artist: 'Biggie Smalls',
        lyrics: '',
    },
];
let artists = [
    {
        name: 'Queen',
        picture: 'assets/images/freddie.png',
    },
    {
        name: 'Michael Jackson',
        picture: 'assets/images/mich.jpg',
    },
    {
        name: 'Led Zeppelin',
        picture: 'assets/images/robert.jpg',
    },
    {
        name: 'Kendrick Lamar',
        picture: 'assets/images/kendrick.jpg',
    },
    {
        name: 'Ghost',
        picture: 'assets/images/ghost.jpg',
    },
    {
        name: 'Cradle of filth',
        picture: 'assets/images/cradle.jpeg',
    },
    {
        name: 'Rammstein',
        picture: 'assets/images/ramm.jpg',
    },
    {
        name: 'Judas Priest',
        picture: 'assets/images/judas.jpg',
    },
    {
        name: 'Mac Miller',
        picture: 'assets/images/mac.jpg',
    },
];
let albums = [
    {
        name: 'Master of puppets',
        picture: 'assets/images/master.jfif',
    },
    {
        name: 'Rust in peace',
        picture: 'assets/images/megadeth.jfif',
    },
    {
        name: 'Ready to die',
        picture: 'assets/images/rdie.jfif',
    },
    {
        name: 'Automatic for the People',
        picture: 'assets/images/autm.jfif',
    },
    {
        name: 'Vaughan Texas Flood',
        picture: 'assets/images/vaughan.jfif',
    },
    {
        name: 'Korn (1994)',
        picture: 'assets/images/korn.jpg',
    },
    {
        name: 'Illmatic',
        picture: 'assets/images/Illmatic.jfif',
    },
    {
        name: 'King 810',
        picture: 'assets/images/king.jpg',
    },
];
function pad(d) {
    return d < 10 ? '0' + d.toString() : d.toString();
}
var type = 'normal';
$(document).ready(function () {
    songs.map(function (song, i) {
        var temp =
            '<div class="song"  data-id="' +
            i +
            '"> <img src="assets/images/equalizer.gif" alt="" class="equalizer_gif" /> <div class="song_num">' +
            pad(i + 1) +
            '</div> <div style="position:relative;"><img src="assets/images/play.png" class="play_hover" alt=""><img src="' +
            song.cover +
            '" class="song_img" /></div> <div class="song_info"> <div class="song_name">' +
            song.name +
            '</div> <div class="song_artist">' +
            song.artist +
            '</div> </div> </div>';
        $('.left_songs_list').append(temp);
    });
    artists.map(function (artist, i) {
        var temp =
            '<div class="pop"> <img class="artist_img" src="' +
            artist.picture +
            '" alt="" /> <div class="pop_text">' +
            artist.name +
            '</div> </div>';
        $('#artists_lists').append(temp);
    });
    albums.map(function (artist, i) {
        var temp =
            '<div class="pop"> <img class="album_cover" src="' +
            artist.picture +
            '" alt="" /> <div class="pop_text">' +
            artist.name +
            '</div> </div>';
        $('#albums_lists').append(temp);
    });
});

var audio = document.getElementsByTagName('audio')[0];
var audioPlayer = document.getElementsByTagName('audio')[0];

var bar_size = 500;

var updateTrack = setInterval(function () {
    var sizee = parseInt((audio.currentTime * bar_size) / audio.duration);
    var volume_size = audioPlayer.volume;
    $('.progress_bar').css('width', '' + sizee + 'px');
    var time = formatTime(audio.currentTime);
    $('.time_start').html(time);
    $('.volume_bar').css('width', '' + volume_size * 150 + 'px');
    if (
        audioPlayer.currentTime == audioPlayer.duration &&
        audioPlayer.duration != 0
    ) {
        var id = parseInt($('.song[selected=selected]').attr('data-id'));
        if (type == 'normal') {
            if (id == songs.length - 1) {
                var idd = 0;
            } else {
                var idd = id + 1;
            }
        } else if (type == 'shuffle') {
            var idd = Math.floor(Math.random() * (songs.length - 1));
            if (idd == id) {
                var idd = Math.floor(Math.random() * (songs.length - 1));
            }
        } else {
            var idd = id;
        }

        audioPlayer.setAttribute('src', songs[idd].src);
        audioPlayer.play();
        $('.song[selected=selected]')
            .removeAttr('selected')
            .removeClass('song_active');
        $('.song[data-id=' + idd + ']')
            .attr('selected', 'true')
            .addClass('song_active');
        $('.song_player').find('.song_img').attr('src', songs[idd].cover);
        $('.song_player').find('.song_name').text(songs[idd].name);
        $('.song_player').find('.song_artist').text(songs[idd].artist);
        $('.song[data-id=' + id + ']')
            .find('.song_num')
            .show();
        $('.song[data-id=' + id + ']')
            .find('.equalizer_gif')
            .hide();
        $('.song[data-id=' + idd + ']')
            .find('.song_num')
            .hide();
        $('.song[data-id=' + idd + ']')
            .find('.equalizer_gif')
            .show();
        $('.right').css(
            'background-image',
            'linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)),url(' +
                songs[idd].cover +
                ')'
        );
        $('.right_song_img').attr('src', '' + songs[idd].cover + '');
        $('.right_song_name').text('' + songs[idd].name + '');
        $('.right_song_artist').text('' + songs[idd].artist + '');
        lyrics(idd);
    }
}, 500);
$(document).on('click', '#play', function () {
    audio.play();
});
canvass = document.getElementById('time_slider');

canvass.addEventListener('click', function (e) {
    if (!e) {
        e = window.event;
    } //get the latest windows event if it isn't set
    try {
        //calculate the current time based on position of mouse cursor in canvas box
        audioPlayer.currentTime =
            audioPlayer.duration * (e.offsetX / canvass.clientWidth);
    } catch (err) {
        // Fail silently but show in F12 developer tools console
        if (window.console && console.error('Error:' + err));
    }
});

vol = document.getElementById('full_height');
vol.addEventListener('click', function (e) {
    if (!e) {
        e = window.event;
    } //get the latest windows event if it isn't set
    try {
        //calculate the current time based on position of mouse cursor in canvas box
        audioPlayer.volume = e.offsetX / vol.clientWidth;
    } catch (err) {
        // Fail silently but show in F12 developer tools console
        if (window.console && console.error('Error:' + err));
    }
    if ($('#mute_icon').is(':visible')) {
        $('#mute_icon').hide();
        $('#volume_icon').show();
    }
});

audioPlayer.onloadedmetadata = function () {
    $('.time_end').html(formatTime(audioPlayer.duration));
};
$(document).on('click', '.song', function () {
    $('.lyrics').html('');
    var id = $(this).data('id');
    var src = songs[id].src;
    audioPlayer.setAttribute('src', src);
    audioPlayer.play();
    $('.song_num').show();
    $('.song_active').removeClass('song_active');
    $(this).addClass('song_active');
    $('.bottom_equalizer_gif').show();
    $('.equalizer_gif').hide();
    $(this).find('.song_num').hide();
    $(this).find('.equalizer_gif').show();
    $('.play_player').hide();
    $('.pause_player').show();
    $('.song[selected=selected]').removeAttr('selected');
    $(this).attr('selected', 'true');
    $('.song_player').find('.song_img').attr('src', songs[id].cover);
    $('.song_player').find('.song_name').text(songs[id].name);
    $('.song_player').find('.song_artist').text(songs[id].artist);
    $('.right').css(
        'background-image',
        'linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)),url(' +
            songs[id].cover +
            ')'
    );
    $('.right').css('background-repeat', 'no-repeat');
    $('.right').css('background-size', 'cover');
    $('.right').css('background-position', '50%');
    $('.right_song_img').attr('src', '' + songs[id].cover + '');
    $('.right_song_name').text('' + songs[id].name + '');
    $('.right_song_artist').text('' + songs[id].artist + '');
    lyrics(id);
});
function formatTime(seconds) {
    minutes = Math.floor(seconds / 60);
    minutes = minutes >= 10 ? minutes : '0' + minutes;
    seconds = Math.floor(seconds % 60);
    seconds = seconds >= 10 ? seconds : '0' + seconds;
    return minutes + ':' + seconds;
}
var canvas,
    ctx,
    source,
    context,
    analyser,
    fbc_array,
    bars,
    bar_x,
    bar_width,
    bar_height;

$(document).ready(function () {
    context = new AudioContext();
    analyser = context.createAnalyser();
    canvas = document.getElementById('analyser');
    ctx = canvas.getContext('2d');
    source = context.createMediaElementSource(audioPlayer);
    source.connect(analyser);
    analyser.connect(context.destination);
    frameLooper();
});

function frameLooper() {
    window.requestAnimationFrame(frameLooper);
    fbc_array = new Uint8Array(analyser.frequencyBinCount);
    analyser.getByteFrequencyData(fbc_array);
    ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas
    ctx.fillStyle = '#238586'; // Color of the bars
    bars = 100;
    for (var i = 0; i < bars; i++) {
        bar_x = i * 3;
        bar_width = 1;
        bar_height = -(fbc_array[i] / 2);
        //  fillRect( x, y, width, height ) // Explanation of the parameters below
        ctx.fillRect(bar_x, canvas.height, bar_width, bar_height);
    }
}
$(document).on('click', '.pause_player', function () {
    audioPlayer.pause();
    $(this).hide();
    $('.play_player').show();
    $('.song_num').show();
    $('.equalizer_gif').hide();
    $('.bottom_equalizer_gif').hide();
});
$(document).on('click', '.play_player', function () {
    audioPlayer.play();
    $(this).hide();
    $('.pause_player').show();
    console.log($('.song[selected=selected]'));
    $('.song[selected=selected]').find('.song_num').hide();
    $('.song[selected=selected]').find('.equalizer_gif').show();
    $('.bottom_equalizer_gif').show();
});

$(document).on('keyup', '.song_input_search', function (e) {
    var searchTerm = $(this).val();
    if (searchTerm == '') {
        $('.left_songs_list').html('');
        songs.map(function (song, i) {
            var temp =
                '<div class="song" data-id="' +
                i +
                '"> <img src="assets/images/equalizer.gif" alt="" class="equalizer_gif" /> <div class="song_num">' +
                pad(i + 1) +
                '</div> <img src="' +
                song.cover +
                '" class="song_img" /> <div class="song_info"> <div class="song_name">' +
                song.name +
                '</div> <div class="song_artist">' +
                song.artist +
                '</div> </div> </div>';
            $('.left_songs_list').append(temp);
        });
    } else {
        var results = songs
            .map(function (song, i) {
                var { name, artist } = song;
                if (
                    name.toLowerCase().includes(searchTerm) == true ||
                    artist.toLowerCase().includes(searchTerm) == true
                ) {
                    return song;
                }
            })
            .filter(Boolean);
        if (results.length > 0) {
            results.map(function (song, i) {
                console.log(song);
                var temp =
                    '<div class="song" data-id="' +
                    i +
                    '"> <img src="assets/images/equalizer.gif" alt="" class="equalizer_gif" /> <div class="song_num">' +
                    pad(i + 1) +
                    '</div> <img src="' +
                    song.cover +
                    '" class="song_img" /> <div class="song_info"> <div class="song_name">' +
                    song.name +
                    '</div> <div class="song_artist">' +
                    song.artist +
                    '</div> </div> </div>';
                $('.left_songs_list').html('');
                $('.left_songs_list').append(temp);
            });
        }
    }
});
var saved_volume = 1;
$(document).on('click', '#volume_icon', function (e) {
    saved_volume = audioPlayer.volume;
    audioPlayer.volume = 0;
    $(this).hide();
    $('#mute_icon').show();
});
$(document).on('click', '#mute_icon', function (e) {
    audioPlayer.volume = saved_volume;
    $(this).hide();
    $('#volume_icon').show();
});
$(document).on('click', '#next_song', function (e) {
    var id = parseInt($('.song[selected=selected]').attr('data-id'));
    if (type == 'normal') {
        if (id == songs.length - 1) {
            var idd = 0;
        } else {
            var idd = id + 1;
        }
    } else if (type == 'shuffle') {
        var idd = Math.floor(Math.random() * songs.length);
        if (idd == id) {
            var idd = Math.floor(Math.random() * (songs.length - 1));
        }
    } else {
        var idd = id;
    }

    audioPlayer.setAttribute('src', songs[idd].src);
    audioPlayer.play();
    $('.song[selected=selected]')
        .removeAttr('selected')
        .removeClass('song_active');
    $('.song[data-id=' + idd + ']')
        .attr('selected', 'true')
        .addClass('song_active');
    $('.song_player').find('.song_img').attr('src', songs[idd].cover);
    $('.song_player').find('.song_name').text(songs[idd].name);
    $('.song_player').find('.song_artist').text(songs[idd].artist);
    $('.song[data-id=' + id + ']')
        .find('.song_num')
        .show();
    $('.song[data-id=' + id + ']')
        .find('.equalizer_gif')
        .hide();
    $('.song[data-id=' + idd + ']')
        .find('.song_num')
        .hide();
    $('.song[data-id=' + idd + ']')
        .find('.equalizer_gif')
        .show();
    $('.right').css(
        'background-image',
        'linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)),url(' +
            songs[idd].cover +
            ')'
    );
    $('.right_song_img').attr('src', '' + songs[idd].cover + '');
    $('.right_song_name').text('' + songs[idd].name + '');
    $('.right_song_artist').text('' + songs[idd].artist + '');
    lyrics(idd);
});
$(document).on('click', '#prev_song', function (e) {
    var id = parseInt($('.song[selected=selected]').attr('data-id'));
    if (id == 0) {
        var idd = songs.length - 1;
    } else {
        var idd = id - 1;
    }

    audioPlayer.setAttribute('src', songs[idd].src);
    audioPlayer.play();
    $('.song[selected=selected]')
        .removeAttr('selected')
        .removeClass('song_active');
    $('.song[data-id=' + idd + ']')
        .attr('selected', 'true')
        .addClass('song_active');
    $('.song_player').find('.song_img').attr('src', songs[idd].cover);
    $('.song_player').find('.song_name').text(songs[idd].name);
    $('.song_player').find('.song_artist').text(songs[idd].artist);
    $('.song[data-id=' + id + ']')
        .find('.song_num')
        .show();
    $('.song[data-id=' + id + ']')
        .find('.equalizer_gif')
        .hide();
    $('.song[data-id=' + idd + ']')
        .find('.song_num')
        .hide();
    $('.song[data-id=' + idd + ']')
        .find('.equalizer_gif')
        .show();
    $('.right').css(
        'background-image',
        'linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)),url(' +
            songs[idd].cover +
            ')'
    );
    $('.right_song_img').attr('src', '' + songs[idd].cover + '');
    $('.right_song_name').text('' + songs[idd].name + '');
    $('.right_song_artist').text('' + songs[idd].artist + '');
    lyrics(idd);
});
function lyrics(id) {
    var lyrics = songs[id].lyrics;

    if (lyrics != '') {
        const lyrics_div = document.querySelector('.lyrics');
        const lines = lyrics.trim().split('\n');

        lyrics_div.style.display = 'block';
        lyrics_div.innerText = '';

        let syncData = [];

        lines.map((line, index) => {
            const [time, text] = line.trim().split('|');
            syncData.push({
                start: time.trim(),
                text: text.trim(),
            });
        });

        audioPlayer.addEventListener('timeupdate', () => {
            syncData.forEach((item) => {
                if (audioPlayer.currentTime >= item.start)
                    lyrics_div.innerText = item.text;
            });
        });
    } else {
        $('.lyrics').hide();
    }
}
$(document).on('click', '#replaySong', function () {
    audioPlayer.currentTime = 0;
});
$(document).on('click', '#order', function () {
    type = 'shuffle';
    $(this).hide();
    $('#shuffle').show();
});
$(document).on('click', '#shuffle', function () {
    type = 'replaySameSong';
    $(this).hide();
    $('#replaySameSong').show();
});
$(document).on('click', '#replaySameSong', function () {
    type = 'normal';
    $(this).hide();
    $('#order').show();
});
